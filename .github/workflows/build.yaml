name: Build

on:
  workflow_dispatch:
  pull_request:
  push:

env:
  # Customize the CMake build type here (Release, Debug, RelWithDebInfo, etc.)
  BUILD_TYPE: Debug
  BOOST_INSTALL_DIR: "${{github.workspace}}/bin"
  BOOST_TOOLSET: "msvc"
  BOOST_VERSION: "1.79.0.beta1"

jobs:
  build_ubuntu_20:
    runs-on: ubuntu-20.04
    steps:
      - name: Install Dependencies
        run: sudo apt-get install -y libboost-dev

      - name: Install Qt
        uses: jurplel/install-qt-action@v3
        with:
          version: "5.12.8"
          setup-python: 'false'

      - name: Checkout
        uses: actions/checkout@v2
        with:
          submodules: true

      - name: Configure
        run: cmake -B ${{github.workspace}}/build -DCMAKE_BUILD_TYPE=${{env.BUILD_TYPE}}

      - name: Build
        run: cmake --build ${{github.workspace}}/build --parallel 4 --config ${{env.BUILD_TYPE}}

  build_windows:
    runs-on: windows-latest
    steps:
      - name: Install Qt
        uses: jurplel/install-qt-action@v3
        with:
          version: "5.12.8"
          setup-python: 'false'

      - name: Install boost
        uses: MarkusJx/install-boost@v2.4.1
        id: install-boost
        with:
            # REQUIRED: Specify the required boost version
            # A list of supported versions can be found here:
            # https://github.com/MarkusJx/prebuilt-boost/blob/main/versions-manifest.json
            boost_version: 1.78.0
            platform_version: ${{env.BOOST_VERSION}}
            toolset: ${{env.BOOST_TOOLSET}}
            boost_install_dir: ${{env.BOOST_INSTALL_DIR}}

      - name: Checkout
        uses: actions/checkout@v2
        with:
          submodules: true

      - name: Configure
        run: |
          cmake -B ${{github.workspace}}/build -DCMAKE_BUILD_TYPE=${{env.BUILD_TYPE}} \
          -DBoost_INCLUDE_DIR=${{env.BOOST_INSTALL_DIR}}/boost/boost/include\
          -Boost_LIBRARY_DIRS=${{env.BOOST_INSTALL_DIR}}/boost/boost/lib\
        env:
          BOOST_ROOT: "${{env.BOOST_INSTALL_DIR}}/boost/boost"

      - name: Build
        run:
          cmake --build ${{github.workspace}}/build --parallel 4 --target ALL_BUILD --config ${{env.BUILD_TYPE}}
